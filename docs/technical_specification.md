# Техническое задание: Тренажёр для подготовки к МОК-интервью

## 1. Цель проекта
Создать масштабируемое приложение для тренировки ответов на вопросы МОК-интервью, начиная с уровня Python Junior, с возможностью добавления других уровней (Middle, Senior) в будущем. Включает веб-интерфейс (с админ-панелью) и Telegram-бот, используя вопросы и ответы из предоставленного документа.

## 2. Функциональные требования

### 2.1. Веб-приложение (пользовательская часть)
- Отображение случайного вопроса из базы (128 вопросов для Junior, с поддержкой других уровней).
- Фильтрация вопросов по уровню подготовки (например, выбор "Junior", "Middle", "Senior").
- Возможность ввода ответа и проверка с выводом правильного ответа.
- Личная статистика пользователя (попытки, процент правильных ответов, разбивка по уровням).
- Интерфейс: HTML-шаблоны с серверным рендерингом (Jinja2) и минимальным JS.

### 2.2. Веб-приложение (админ-панель)
- Аутентификация администратора (логин/пароль, JWT-токены).
- CRUD-операции для вопросов и ответов с указанием уровня (добавление, редактирование, удаление).
- Просмотр статистики всех пользователей (попытки, процент правильных ответов, по уровням).
- Экспорт статистики в CSV.
- Управление пользователями (просмотр, блокировка/удаление аккаунтов).

### 2.3. Telegram-бот
- **Пользовательские команды**:
  - `/question` — получение случайного вопроса с выбором уровня (например, `/question junior`).
  - `/stats` — личная статистика (попытки, процент правильных ответов, по уровням).
  - Проверка текстовых ответов с обратной связью.
- **Админ-команды**:
  - `/admin_questions` — просмотр, добавление, редактирование вопросов с указанием уровня.
  - `/admin_stats` — статистика по всем пользователям, разбитая по уровням.
  - Аутентификация админа (пароль или токен в личных сообщениях).

### 2.4. Общие функции
- Хранение вопросов, ответов, пользователей и статистики в MySQL.
- Поддержка масштабируемости: таблица `interview_questions` включает поле `level` (varchar, например, "junior", "middle", "senior").
- Асинхронная обработка запросов для веб и бота.
- Валидация входных данных через Pydantic.

## 3. Технические требования
- **Dev-среда**:
  - Python 3.13.
  - IDE: PyCharm 2024.3.4.
  - Виртуальное окружение (`python3.13 -m venv .venv`).
- **Prod-среда**:
  - Python 3.13.
  - Ubuntu 24.04.
  - MySQL сервер для хранения данных.
  - Развёртывание: gunicorn + uvicorn, systemd для автозапуска.
- **Технологии**:
  - FastAPI для API и вебхуков бота.
  - MySQL для базы данных.
  - SQLAlchemy с драйвером `pymysql` для работы с MySQL.
  - Pydantic для валидации.
  - `aiogram` для Telegram-бота.
  - `passlib`, `python-jose` для аутентификации.
  - Jinja2 для серверного рендеринга HTML.
  - `python-dotenv` для переменных окружения.
  - `flake8`, `black` для проверки и форматирования кода.
  - `pytest` для юнит-тестов.
  - `alembic` для миграций базы данных.
  - `prometheus-fastapi-instrumentator` для мониторинга.
- **Ограничения**:
  - Минимальные внешние зависимости.
  - Уникальные имена файлов/папок, соответствие PEP 8.
  - Локальное хранение данных (без внешних API).

## 4. Структура проекта

mock-interview-python/
├── core/
│   ├── __init__.py
│   ├── database.py
│   ├── models.py
│   └── logic.py
├── api/
│   ├── __init__.py
│   ├── user_endpoints.py
│   └── admin_endpoints.py
├── bot/
│   ├── __init__.py
│   └── handlers/
│       ├── __init__.py
│       ├── admin/
│       │   ├── __init__.py
│       │   └── admin_handlers.py
│       └── user/
│           ├── __init__.py
│           └── user_handlers.py
├── templates/
│   ├── user/
│   │   ├── index.html
│   │   └── stats.html
│   └── admin/
│       ├── index.html
│       ├── questions.html
│       └── users.html
├── static/
│   ├── user/
│   │   ├── user.js
│   │   └── user.css
│   └── admin/
│       ├── admin.js
│       └── admin.css
├── data/
│   ├── __init__.py
│   └── load_questions.py
├── docs/
│   ├── technical_specification.md
│   └── implementation_plan.md
├── tests/
│   ├── __init__.py
│   ├── test_logic.py
│   ├── test_api.py
│   └── test_bot.py
├── logs/
│   └── app.log
├── migrations/
│   └── (alembic files)
├── main.py
├── requirements.txt
├── .env.example
├── .env.dev
├── .env.prod
├── .gitignore
└── README.md


## 5. Критерии приемки
- Веб-приложение:
  - Пользователь может выбрать уровень, получить вопрос, ответить и увидеть результат.
  - Админ может войти, управлять вопросами (с учётом уровня) и просматривать статистику.
  - Статистика экспортируется в CSV.
- Telegram-бот:
  - Пользовательские команды работают с выбором уровня.
  - Админ-команды доступны после аутентификации.
- Код:
  - Соответствует PEP 8 (проверка через `flake8`, форматирование через `black`).
  - Модульная структура, поддерживает добавление новых уровней.
  - Полная документация (docstrings, `README.md`).
  - Покрытие тестами основных модулей.
- Развёртывание:
  - Приложение запускается на Ubuntu 24.04 с MySQL без ошибок.
  - Логи пишутся в `logs/app.log`, доступны метрики через Prometheus.

## 6. Ограничения
- Не использовать внешние API для хранения данных.
- Минимизировать зависимости, кроме указанных.
- Сохранять согласованные имена файлов/папок.

## 7. Дополнительные требования
- **Логирование**:
  - Использовать `logging` с ротацией логов.
  - Dev: DEBUG уровень, запись в консоль и файл `logs/app.log`.
  - Prod: INFO уровень, запись только в файл.
- **Документирование**:
  - Docstrings для всех модулей, классов и функций (формат Google или reStructuredText).
  - Обновлённый `README.md` с инструкциями по запуску, настройке MySQL, переменных окружения и деплою.
- **Тестирование**:
  - Юнит-тесты с `pytest` для `core/`, `api/`, `bot/`.
  - Минимальное покрытие 80% для основных модулей.
- **Безопасность**:
  - Хеширование паролей с помощью `bcrypt`.
  - Защита от SQL-инъекций через SQLAlchemy.
  - Rate limiting для API.
- **Переменные окружения**:
  - Использовать `python-dotenv`.
  - Предоставить `.env.example` с описанием всех переменных (например, `DATABASE_URL`, `BOT_TOKEN`).
- **Миграции**:
  - Использовать `alembic` для управления схемой MySQL.
- **Мониторинг**:
  - Метрики через `prometheus-fastapi-instrumentator`.
  - Уведомления об ошибках через Telegram-бота для админов.
- **Секретные данные**:
  - Хранить в `.env.dev` и `.env.prod`, исключить из репозитория через `.gitignore`.
  - Предоставить `.env.example` с шаблоном переменных.
  - Генерировать `JWT_SECRET_KEY` с помощью `openssl rand -hex 32`.